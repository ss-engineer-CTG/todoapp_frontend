<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Focus View - ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        background: 'rgb(var(--background) / <alpha-value>)',
                        foreground: 'rgb(var(--foreground) / <alpha-value>)',
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --background: 255 255 255;
            --foreground: 0 0 0;
        }
        .dark {
            --background: 15 23 42;
            --foreground: 241 245 249;
        }
        
        
        /* ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ« */
        .markdown-editor {
            min-height: 300px;
            resize: vertical;
        }
        
        /* ãƒãƒ£ãƒ¼ãƒˆã‚³ãƒ³ãƒ†ãƒŠ */
        .chart-container {
            position: relative;
            height: 200px;
            width: 100%;
        }
        
        /* ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ« */
        .resize-handle {
            width: 4px;
            cursor: col-resize;
            user-select: none;
        }
        
        .resize-handle:hover {
            background-color: #3b82f6;
        }
        
        .resizing {
            user-select: none;
        }
    </style>
</head>
<body class="bg-background text-foreground">
    <!-- ViewSwitcher -->
    <div class="absolute top-4 left-4 z-50 flex bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden">
        <button class="px-3 py-2 text-sm font-medium rounded-none border-r border-gray-200 dark:border-gray-700 flex items-center space-x-2 transition-colors bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="8" y1="6" x2="21" y2="6"></line>
                <line x1="8" y1="12" x2="21" y2="12"></line>
                <line x1="8" y1="18" x2="21" y2="18"></line>
                <line x1="3" y1="6" x2="3.01" y2="6"></line>
                <line x1="3" y1="12" x2="3.01" y2="12"></line>
                <line x1="3" y1="18" x2="3.01" y2="18"></line>
            </svg>
        </button>
        <button class="px-3 py-2 text-sm font-medium rounded-none border-r border-gray-200 dark:border-gray-700 flex items-center space-x-2 transition-colors bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        </button>
        <button class="px-3 py-2 text-sm font-medium rounded-none flex items-center space-x-2 transition-colors bg-blue-600 text-white">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2 2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
        </button>
    </div>

    <!-- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ -->
    <button id="darkModeToggle" class="absolute top-4 right-4 z-50 p-2 rounded-lg bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 border border-gray-200 dark:border-gray-700 shadow-lg transition-colors">
        <!-- ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆæœˆï¼‰ -->
        <svg id="darkModeIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="dark:hidden">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
        <!-- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆå¤ªé™½ï¼‰ -->
        <svg id="lightModeIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="hidden dark:block">
            <circle cx="12" cy="12" r="5"></circle>
            <path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>
        </svg>
    </button>


    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div class="flex h-screen bg-gray-50 dark:bg-gray-900 pt-16">
        <!-- å·¦ãƒ‘ãƒãƒ«: ä»Šæœˆã®ç›®æ¨™ & å­¦ç¿’æ™‚é–“ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚° -->
        <div id="leftPanel" class="w-1/4 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 p-4 overflow-y-auto">
            <!-- ä»Šæœˆã®ç›®æ¨™ -->
            <div class="mb-6">
                <h2 class="text-lg font-semibold mb-2 flex items-center">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="mr-2">
                        <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"></polygon>
                    </svg>
                    ä»Šæœˆã®ç›®æ¨™
                </h2>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">2024å¹´12æœˆ</p>
                
                <!-- ç›®æ¨™ãƒªã‚¹ãƒˆ -->
                <div class="space-y-3">
                    <div class="goal-item p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800 cursor-pointer transition-colors hover:bg-blue-100 dark:hover:bg-blue-900/40" data-goal-id="programming">
                        <h3 class="font-medium text-blue-900 dark:text-blue-100">ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚¹ã‚­ãƒ«å‘ä¸Š</h3>
                        <p class="text-sm text-blue-700 dark:text-blue-300 mt-1">React + TypeScriptã‚’ä½¿ã£ãŸå®Ÿè·µçš„ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã‚’ãƒã‚¹ã‚¿ãƒ¼ã™ã‚‹</p>
                    </div>
                    <div class="goal-item p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800 cursor-pointer transition-colors hover:bg-green-100 dark:hover:bg-green-900/40" data-goal-id="english">
                        <h3 class="font-medium text-green-900 dark:text-green-100">è‹±èªå­¦ç¿’</h3>
                        <p class="text-sm text-green-700 dark:text-green-300 mt-1">TOEIC 800ç‚¹ã‚’ç›®æŒ‡ã—ã¦æ¯æ—¥30åˆ†ã®å­¦ç¿’ã‚’ç¶™ç¶šã™ã‚‹</p>
                    </div>
                    <div class="goal-item p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800 cursor-pointer transition-colors hover:bg-purple-100 dark:hover:bg-purple-900/40" data-goal-id="health">
                        <h3 class="font-medium text-purple-900 dark:text-purple-100">å¥åº·ç®¡ç†</h3>
                        <p class="text-sm text-purple-700 dark:text-purple-300 mt-1">é€±3å›ã®é‹å‹•ç¿’æ…£ã‚’èº«ã«ã¤ã‘ã¦ä½“åŠ›å‘ä¸Šã‚’å›³ã‚‹</p>
                    </div>
                </div>
                
                <!-- æ–°ã—ã„ç›®æ¨™è¿½åŠ  -->
                <button class="w-full mt-4 p-2 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg text-gray-500 dark:text-gray-400 hover:border-gray-400 dark:hover:border-gray-500 transition-colors">
                    + æ–°ã—ã„ç›®æ¨™ã‚’è¿½åŠ 
                </button>
            </div>
            
            <!-- å­¦ç¿’æ™‚é–“ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚° -->
            <div class="mb-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                <h3 class="text-md font-semibold mb-3 flex items-center text-blue-900 dark:text-blue-100">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="mr-2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12,6 12,12 16,14"></polyline>
                    </svg>
                    å­¦ç¿’æ™‚é–“ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
                </h3>
                
                <!-- ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ -->
                <div class="mb-4 p-3 bg-white dark:bg-gray-800 rounded-lg border border-blue-200 dark:border-blue-700">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³</span>
                        <span id="currentSessionTime" class="text-lg font-bold text-blue-600">00:00:00</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-600 dark:text-gray-400">ä»Šæ—¥ã®ç´¯è¨ˆ</span>
                        <span id="todayTotalTime" class="text-sm font-medium text-gray-800 dark:text-gray-200">2æ™‚é–“ 34åˆ†</span>
                    </div>
                </div>
                
                <!-- ã‚«ãƒ†ã‚´ãƒªé¸æŠã¨åˆ¶å¾¡ãƒœã‚¿ãƒ³ -->
                <div class="space-y-3">
                    <div class="flex items-center space-x-2">
                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300">ã‚«ãƒ†ã‚´ãƒª:</label>
                        <select id="learningCategory" class="flex-1 px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800">
                            <option value="programming">ğŸ“š ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°</option>
                            <option value="english">ğŸ—£ï¸ è‹±èªå­¦ç¿’</option>
                            <option value="reading">ğŸ“– èª­æ›¸</option>
                            <option value="exercise">ğŸƒ é‹å‹•</option>
                            <option value="other">ğŸ“ ãã®ä»–</option>
                        </select>
                    </div>
                    
                    <div class="flex space-x-2">
                        <button id="startLearningBtn" class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium">
                            â–¶ï¸ å­¦ç¿’é–‹å§‹
                        </button>
                        <button id="pauseLearningBtn" class="flex-1 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors font-medium" disabled>
                            â¸ï¸ ä¸€æ™‚åœæ­¢
                        </button>
                        <button id="stopLearningBtn" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium" disabled>
                            â¹ï¸ çµ‚äº†
                        </button>
                    </div>
                </div>
                
                <!-- ä»Šæ—¥ã®ã‚«ãƒ†ã‚´ãƒªåˆ¥å­¦ç¿’æ™‚é–“ -->
                <div class="mt-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                    <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ä»Šæ—¥ã®ã‚«ãƒ†ã‚´ãƒªåˆ¥æ™‚é–“</h4>
                    <div class="space-y-1 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600 dark:text-gray-400">ğŸ“š ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°</span>
                            <span class="font-medium">1æ™‚é–“ 25åˆ†</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600 dark:text-gray-400">ğŸ—£ï¸ è‹±èªå­¦ç¿’</span>
                            <span class="font-medium">45åˆ†</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600 dark:text-gray-400">ğŸ“– èª­æ›¸</span>
                            <span class="font-medium">24åˆ†</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ«1 -->
        <div id="resizer1" class="w-1 bg-gray-300 dark:bg-gray-600 cursor-col-resize hover:bg-blue-500 transition-colors"></div>

        <!-- ä¸­å¤®ãƒ‘ãƒãƒ«: ä»Šæ—¥ã®ToDoãƒªã‚¹ãƒˆ -->
        <div id="centerPanel" class="w-1/2 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 p-4 overflow-y-auto">
            
            <div class="mb-4">
                <h2 class="text-lg font-semibold mb-2 flex items-center">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="mr-2">
                        <polyline points="9,11 12,14 22,4"></polyline>
                        <path d="M21,12v7a2,2 0 0,1 -2,2H5a2,2 0 0,1 -2,-2V5a2,2 0 0,1 2,-2h11"></path>
                    </svg>
                    ä»Šæ—¥ã®ToDo
                </h2>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">2024å¹´12æœˆ16æ—¥ (æœˆ)</p>
                
                
                <!-- ToDoãƒªã‚¹ãƒˆ -->
                <div class="space-y-2">
                    <div class="todo-item flex items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer transition-colors hover:bg-gray-100 dark:hover:bg-gray-600" id="existing-todo-1" data-todo-id="existing-1">
                        <input type="checkbox" class="mr-3 w-4 h-4 text-blue-600 rounded">
                        <span class="flex-1">React Hooksã®å¾©ç¿’ï¼ˆuseEffectç·¨ï¼‰</span>
                        <span class="text-xs text-gray-500 bg-blue-100 dark:bg-blue-900 px-2 py-1 rounded">ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°</span>
                    </div>
                    <div class="todo-item flex items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer transition-colors hover:bg-gray-100 dark:hover:bg-gray-600" id="existing-todo-2" data-todo-id="existing-2">
                        <input type="checkbox" checked class="mr-3 w-4 h-4 text-blue-600 rounded">
                        <span class="flex-1 line-through text-gray-500">è‹±èªãƒªã‚¹ãƒ‹ãƒ³ã‚°30åˆ†</span>
                        <span class="text-xs text-gray-500 bg-green-100 dark:bg-green-900 px-2 py-1 rounded">è‹±èª</span>
                    </div>
                    <div class="todo-item flex items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer transition-colors hover:bg-gray-100 dark:hover:bg-gray-600" id="existing-todo-3" data-todo-id="existing-3">
                        <input type="checkbox" class="mr-3 w-4 h-4 text-blue-600 rounded">
                        <span class="flex-1">ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ï¼ˆ5kmï¼‰</span>
                        <span class="text-xs text-gray-500 bg-purple-100 dark:bg-purple-900 px-2 py-1 rounded">é‹å‹•</span>
                    </div>
                    <div class="todo-item flex items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer transition-colors hover:bg-gray-100 dark:hover:bg-gray-600" id="existing-todo-4" data-todo-id="existing-4">
                        <input type="checkbox" class="mr-3 w-4 h-4 text-blue-600 rounded">
                        <span class="flex-1">TypeScriptå‹å®šç¾©ã®å®Ÿè·µ</span>
                        <span class="text-xs text-gray-500 bg-blue-100 dark:bg-blue-900 px-2 py-1 rounded">ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°</span>
                    </div>
                    <div class="todo-item flex items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer transition-colors hover:bg-gray-100 dark:hover:bg-gray-600" id="existing-todo-5" data-todo-id="existing-5">
                        <input type="checkbox" class="mr-3 w-4 h-4 text-blue-600 rounded">
                        <span class="flex-1">æŠ€è¡“æ›¸èª­æ›¸ï¼ˆClean Codeï¼‰</span>
                        <span class="text-xs text-gray-500 bg-orange-100 dark:bg-orange-900 px-2 py-1 rounded">èª­æ›¸</span>
                    </div>
                </div>
                
                <!-- æ–°ã—ã„ToDoè¿½åŠ  -->
                <div class="mt-4 space-y-2">
                    <div class="flex">
                        <input id="newTodoInput" type="text" placeholder="æ–°ã—ã„ToDoã‚’è¿½åŠ ..." class="flex-1 p-2 border border-gray-300 dark:border-gray-600 rounded-l-lg bg-white dark:bg-gray-800">
                        <button id="addTodoBtn" class="px-4 py-2 bg-blue-600 text-white rounded-r-lg hover:bg-blue-700 transition-colors">è¿½åŠ </button>
                    </div>
                    
                    <!-- ã‚¿ã‚°é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
                    <div id="tagSelectionModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center" tabindex="-1">
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 w-80 max-w-full mx-4" onclick="event.stopPropagation()">
                            <h3 class="text-md font-semibold mb-3 text-gray-900 dark:text-gray-100">ã‚¿ã‚¹ã‚¯ã«ã‚¿ã‚°ã‚’é¸æŠ</h3>
                            <p id="taskPreview" class="text-xs text-gray-600 dark:text-gray-400 mb-3 p-2 bg-gray-100 dark:bg-gray-700 rounded"></p>
                            
                            <div class="space-y-1" id="tagOptions">
                                <!-- ç›®æ¨™ã‚¿ã‚° -->
                                <div class="text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">ä»Šæœˆã®ç›®æ¨™</div>
                                <div class="tag-option cursor-pointer p-2 rounded border-2 border-transparent hover:border-blue-300 transition-colors bg-blue-50 dark:bg-blue-900/20" data-value="programming">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-3 h-3 rounded-full bg-gradient-to-r from-blue-200 to-blue-500"></div>
                                        <span class="text-xs text-blue-800 dark:text-blue-200">ğŸ“š ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚¹ã‚­ãƒ«å‘ä¸Š</span>
                                    </div>
                                </div>
                                <div class="tag-option cursor-pointer p-2 rounded border-2 border-transparent hover:border-green-300 transition-colors bg-green-50 dark:bg-green-900/20" data-value="english">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-3 h-3 rounded-full bg-gradient-to-r from-green-200 to-green-500"></div>
                                        <span class="text-xs text-green-800 dark:text-green-200">ğŸ—£ï¸ è‹±èªå­¦ç¿’</span>
                                    </div>
                                </div>
                                <div class="tag-option cursor-pointer p-2 rounded border-2 border-transparent hover:border-purple-300 transition-colors bg-purple-50 dark:bg-purple-900/20" data-value="health">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-3 h-3 rounded-full bg-gradient-to-r from-purple-200 to-purple-500"></div>
                                        <span class="text-xs text-purple-800 dark:text-purple-200">ğŸƒ å¥åº·ç®¡ç†</span>
                                    </div>
                                </div>
                                
                                <div class="text-xs font-medium text-gray-500 dark:text-gray-400 mb-1 mt-2">ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚°</div>
                                <div class="tag-option cursor-pointer p-2 rounded border-2 border-transparent hover:border-orange-300 transition-colors bg-orange-50 dark:bg-orange-900/20" data-value="custom1">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 rounded-full bg-gradient-to-r from-orange-200 to-orange-500"></div>
                                            <span class="text-xs text-orange-800 dark:text-orange-200" id="custom1Label">ğŸ“š èª­æ›¸</span>
                                        </div>
                                        <button class="edit-tag-btn text-xs text-gray-500 hover:text-orange-600 px-1" data-tag="custom1" onclick="event.stopPropagation(); startEditTag('custom1')">âœï¸</button>
                                    </div>
                                </div>
                                <div class="tag-option cursor-pointer p-2 rounded border-2 border-transparent hover:border-teal-300 transition-colors bg-teal-50 dark:bg-teal-900/20" data-value="custom2">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 rounded-full bg-gradient-to-r from-teal-200 to-teal-500"></div>
                                            <span class="text-xs text-teal-800 dark:text-teal-200" id="custom2Label">ğŸ  å®¶äº‹</span>
                                        </div>
                                        <button class="edit-tag-btn text-xs text-gray-500 hover:text-teal-600 px-1" data-tag="custom2" onclick="event.stopPropagation(); startEditTag('custom2')">âœï¸</button>
                                    </div>
                                </div>
                                <div class="tag-option cursor-pointer p-2 rounded border-2 border-transparent hover:border-rose-300 transition-colors bg-rose-50 dark:bg-rose-900/20" data-value="custom3">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 rounded-full bg-gradient-to-r from-rose-200 to-rose-500"></div>
                                            <span class="text-xs text-rose-800 dark:text-rose-200" id="custom3Label">ğŸ¨ è¶£å‘³</span>
                                        </div>
                                        <button class="edit-tag-btn text-xs text-gray-500 hover:text-rose-600 px-1" data-tag="custom3" onclick="event.stopPropagation(); startEditTag('custom3')">âœï¸</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex justify-end space-x-2 mt-4">
                                <button id="cancelTagSelection" class="px-3 py-1 text-xs text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                                <button id="skipTagSelection" class="px-3 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors">ã‚¿ã‚°ãªã—ã§è¿½åŠ </button>
                            </div>
                            
                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-2 text-center">â†‘â†“ çŸ¢å°ã‚­ãƒ¼ã§é¸æŠã€Enterã§æ±ºå®šã€âœï¸ã‚¯ãƒªãƒƒã‚¯ã§ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚°ç·¨é›†</div>
                        </div>
                    </div>
                    
                    <!-- ã‚¿ã‚°ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
                    <div id="tagEditModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-60 flex items-center justify-center" tabindex="-1">
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 w-72 max-w-full mx-4" onclick="event.stopPropagation()">
                            <h3 class="text-md font-semibold mb-3 text-gray-900 dark:text-gray-100">ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚°ç·¨é›†</h3>
                            
                            <div class="space-y-3">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 rounded-full bg-gradient-to-r from-orange-200 to-orange-500"></div>
                                    <input type="text" id="editCustom1Input" class="flex-1 px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800" placeholder="ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚°1">
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 rounded-full bg-gradient-to-r from-teal-200 to-teal-500"></div>
                                    <input type="text" id="editCustom2Input" class="flex-1 px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800" placeholder="ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚°2">
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 rounded-full bg-gradient-to-r from-rose-200 to-rose-500"></div>
                                    <input type="text" id="editCustom3Input" class="flex-1 px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800" placeholder="ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚°3">
                                </div>
                            </div>
                            
                            <div class="flex justify-end space-x-2 mt-4">
                                <button id="cancelTagEdit" class="px-3 py-1 text-xs text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                                <button id="saveTagEdit" class="px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors">ä¿å­˜</button>
                            </div>
                            
                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-2 text-center">çµµæ–‡å­—ã‚’å«ã‚ã¦è¨­å®šã§ãã¾ã™</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ«2 -->
        <div id="resizer2" class="w-1 bg-gray-300 dark:bg-gray-600 cursor-col-resize hover:bg-blue-500 transition-colors"></div>

        <!-- å³ãƒ‘ãƒãƒ«: ä»Šæ—¥ã®ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆãƒ¡ãƒ¢ & æˆé•·å¯è¦–åŒ– -->
        <div id="rightPanel" class="w-1/4 bg-white dark:bg-gray-800 p-4 overflow-y-auto">
            <!-- ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆãƒ¡ãƒ¢ -->
            <div class="mb-6">
                <h2 class="text-lg font-semibold mb-2 flex items-center">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="mr-2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14,2 14,8 20,8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10,9 9,9 8,9"></polyline>
                    </svg>
                    å­¦ç¿’ãƒ¡ãƒ¢
                </h2>
                
                
                <!-- ãƒ¡ãƒ¢ã‚¨ãƒ‡ã‚£ã‚¿ -->
                <textarea 
                    class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 markdown-editor"
                    placeholder="# ä»Šæ—¥ã®å­¦ç¿’å†…å®¹

## React Hooks - useEffect

### å­¦ã‚“ã ã“ã¨
- useEffectã®åŸºæœ¬çš„ãªä½¿ã„æ–¹
- ä¾å­˜é…åˆ—ã®é‡è¦æ€§
- ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã®å¿…è¦æ€§

### å®Ÿè·µä¾‹
```javascript
useEffect(() => {
  // ã‚µã‚¤ãƒ‰ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®å‡¦ç†
  return () => {
    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†
  };
}, [dependencies]);
```

### ç–‘å•ãƒ»èª²é¡Œ
- ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã§ã®ä½¿ã„åˆ†ã‘
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹"
                ></textarea>
                
            </div>
            
            <!-- æˆé•·å¯è¦–åŒ–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
            <div class="mb-6">
                <h3 class="text-md font-semibold mb-3 flex items-center">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="mr-2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <rect x="7" y="8" width="2" height="8"></rect>
                        <rect x="11" y="12" width="2" height="4"></rect>
                        <rect x="15" y="6" width="2" height="10"></rect>
                    </svg>
                    æˆé•·ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
                </h3>
                
                <!-- æ´»å‹•ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ— -->
                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4">
                    <!-- ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                    <div class="mb-3">
                        <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£</h4>
                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">éå»365æ—¥</div>
                    </div>
                    
                    <!-- æ—¥å˜ä½ãƒ“ãƒ¥ãƒ¼ -->
                    <div id="dailyView" class="space-y-1">
                        <!-- æœˆãƒ©ãƒ™ãƒ«ï¼ˆæ¨ªè»¸ï¼‰ -->
                        <div id="monthLabels" class="flex text-xs text-gray-500 dark:text-gray-400 mb-2">
                            <div class="w-8"></div>
                            <div class="flex-1 overflow-hidden" id="monthLabelsScrollContainer">
                                <div id="monthLabelsContainer" class="relative">
                                    <!-- å‹•çš„ç”Ÿæˆ -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã‚³ãƒ³ãƒ†ãƒŠ -->
                        <div class="flex">
                            <!-- æ›œæ—¥ãƒ©ãƒ™ãƒ«ï¼ˆç¸¦è»¸ï¼šæ—¥æ›œæ—¥å§‹ã¾ã‚Šï¼‰ -->
                            <div class="w-8 flex flex-col gap-0.5 text-xs text-gray-500 dark:text-gray-400 mr-2">
                                <div class="h-3 flex items-center">Sun</div>
                                <div class="h-3 flex items-center">Mon</div>
                                <div class="h-3 flex items-center">Tue</div>
                                <div class="h-3 flex items-center">Wed</div>
                                <div class="h-3 flex items-center">Thu</div>
                                <div class="h-3 flex items-center">Fri</div>
                                <div class="h-3 flex items-center">Sat</div>
                            </div>
                            
                            <!-- æ—¥å˜ä½ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã‚°ãƒªãƒƒãƒ‰ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ï¼‰ -->
                            <div id="heatmapScrollContainer" class="flex-1 overflow-x-auto">
                                <div id="dailyHeatmapGrid" class="min-w-max">
                                    <!-- å‹•çš„ç”Ÿæˆ -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—å‡¡ä¾‹ -->
                    <div class="flex items-center justify-between mt-3 text-xs text-gray-500 dark:text-gray-400">
                        <span>Less</span>
                        <div class="flex items-center space-x-1">
                            <div class="w-2 h-2 bg-gray-100 dark:bg-gray-600 rounded-sm"></div>
                            <div class="w-2 h-2 bg-green-100 dark:bg-green-900/30 rounded-sm"></div>
                            <div class="w-2 h-2 bg-green-200 dark:bg-green-800/50 rounded-sm"></div>
                            <div class="w-2 h-2 bg-green-300 dark:bg-green-700/70 rounded-sm"></div>
                            <div class="w-2 h-2 bg-green-400 dark:bg-green-600 rounded-sm"></div>
                            <div class="w-2 h-2 bg-green-500 dark:bg-green-500 rounded-sm"></div>
                            <div class="w-2 h-2 bg-green-600 dark:bg-green-400 rounded-sm"></div>
                        </div>
                        <span>More</span>
                    </div>
                </div>
                
                <!-- ã‚«ã‚¹ã‚¿ãƒ ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ— -->
                <div id="heatmapTooltip" class="fixed bg-gray-900 text-white text-xs rounded px-2 py-1 pointer-events-none z-50 opacity-0 transition-opacity duration-200 shadow-lg">
                    <div id="tooltipContent"></div>
                    <div class="absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-full">
                        <div class="w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å­¦ç¿’æ™‚é–“ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
        let learningSession = {
            startTime: null,
            pausedTime: 0,
            isActive: false,
            isPaused: false,
            currentCategory: 'programming',
            timer: null
        };


        // å­¦ç¿’æ™‚é–“ã®ç®¡ç†
        function startLearning() {
            learningSession.startTime = new Date();
            learningSession.isActive = true;
            learningSession.isPaused = false;
            learningSession.currentCategory = document.getElementById('learningCategory').value;
            
            updateButtons();
            startTimer();
            console.log('å­¦ç¿’é–‹å§‹:', learningSession.currentCategory);
        }

        function pauseLearning() {
            learningSession.isPaused = true;
            learningSession.pausedTime += new Date() - learningSession.startTime;
            
            updateButtons();
            stopTimer();
            console.log('å­¦ç¿’ä¸€æ™‚åœæ­¢');
        }

        function resumeLearning() {
            learningSession.startTime = new Date();
            learningSession.isPaused = false;
            
            updateButtons();
            startTimer();
            console.log('å­¦ç¿’å†é–‹');
        }

        function stopLearning() {
            if (!learningSession.isPaused) {
                learningSession.pausedTime += new Date() - learningSession.startTime;
            }
            
            const totalTime = learningSession.pausedTime;
            console.log('å­¦ç¿’çµ‚äº†ã€‚ç·æ™‚é–“:', Math.floor(totalTime / 1000 / 60), 'åˆ†');
            
            // ãƒªã‚»ãƒƒãƒˆ
            learningSession = {
                startTime: null,
                pausedTime: 0,
                isActive: false,
                isPaused: false,
                currentCategory: 'programming',
                timer: null
            };
            
            updateButtons();
            stopTimer();
            document.getElementById('currentSessionTime').textContent = '00:00:00';
        }

        function updateButtons() {
            const startBtn = document.getElementById('startLearningBtn');
            const pauseBtn = document.getElementById('pauseLearningBtn');
            const stopBtn = document.getElementById('stopLearningBtn');
            
            if (!learningSession.isActive) {
                startBtn.disabled = false;
                startBtn.textContent = 'â–¶ï¸ å­¦ç¿’é–‹å§‹';
                startBtn.onclick = startLearning;
                pauseBtn.disabled = true;
                stopBtn.disabled = true;
            } else if (learningSession.isPaused) {
                startBtn.disabled = false;
                startBtn.textContent = 'â–¶ï¸ å†é–‹';
                startBtn.onclick = resumeLearning;
                pauseBtn.disabled = true;
                stopBtn.disabled = false;
            } else {
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                stopBtn.disabled = false;
            }
        }

        function startTimer() {
            learningSession.timer = setInterval(updateCurrentTime, 1000);
        }

        function stopTimer() {
            if (learningSession.timer) {
                clearInterval(learningSession.timer);
                learningSession.timer = null;
            }
        }

        function updateCurrentTime() {
            if (learningSession.isActive && !learningSession.isPaused) {
                const currentTime = new Date() - learningSession.startTime + learningSession.pausedTime;
                const hours = Math.floor(currentTime / 1000 / 60 / 60);
                const minutes = Math.floor((currentTime / 1000 / 60) % 60);
                const seconds = Math.floor((currentTime / 1000) % 60);
                
                document.getElementById('currentSessionTime').textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        // PCãƒ­ãƒƒã‚¯æ¤œçŸ¥ã«ã‚ˆã‚‹è‡ªå‹•ä¸€æ™‚åœæ­¢
        function handleVisibilityChange() {
            if (document.hidden && learningSession.isActive && !learningSession.isPaused) {
                console.log('PCãƒ­ãƒƒã‚¯æ¤œçŸ¥: è‡ªå‹•ä¸€æ™‚åœæ­¢');
                pauseLearning();
            }
        }

        // ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆé€£ç¶šæ—¥æ•°ã®è¨ˆç®—
        function calculateOutputStreak() {
            // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€éå»ã®æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª
            // ç¾åœ¨ã¯å›ºå®šå€¤ã§ãƒ‡ãƒ¢
            return 7;
        }

        function hasOutputToday(memoContent) {
            const hasText = memoContent.length >= 100;
            const hasImages = (memoContent.match(/!\[.*?\]/g) || []).length > 0;
            return hasText || hasImages;
        }
        
        
        
        // ãƒ‘ãƒãƒ«ãƒªã‚µã‚¤ã‚ºæ©Ÿèƒ½
        let isResizing = false;
        let currentResizer = null;
        
        function initPanelResize() {
            const resizer1 = document.getElementById('resizer1');
            const resizer2 = document.getElementById('resizer2');
            const leftPanel = document.getElementById('leftPanel');
            const centerPanel = document.getElementById('centerPanel');
            const rightPanel = document.getElementById('rightPanel');
            const container = leftPanel.parentElement;
            
            // ãƒªã‚µã‚¤ã‚¶ãƒ¼1ï¼ˆå·¦ãƒ‘ãƒãƒ«ã¨ä¸­å¤®ãƒ‘ãƒãƒ«ã®å¢ƒç•Œï¼‰
            resizer1.addEventListener('mousedown', function(e) {
                isResizing = true;
                currentResizer = 'resizer1';
                document.body.classList.add('resizing');
                e.preventDefault();
            });
            
            // ãƒªã‚µã‚¤ã‚¶ãƒ¼2ï¼ˆä¸­å¤®ãƒ‘ãƒãƒ«ã¨å³ãƒ‘ãƒãƒ«ã®å¢ƒç•Œï¼‰
            resizer2.addEventListener('mousedown', function(e) {
                isResizing = true;
                currentResizer = 'resizer2';
                document.body.classList.add('resizing');
                e.preventDefault();
            });
            
            document.addEventListener('mousemove', function(e) {
                if (!isResizing) return;
                
                const containerRect = container.getBoundingClientRect();
                const containerWidth = containerRect.width;
                const mouseX = e.clientX - containerRect.left;
                
                if (currentResizer === 'resizer1') {
                    // å·¦ãƒ‘ãƒãƒ«ã®ãƒªã‚µã‚¤ã‚º
                    const leftWidthPercent = (mouseX / containerWidth) * 100;
                    const centerWidthPercent = parseFloat(centerPanel.style.width || '50') || 50;
                    const rightWidthPercent = 100 - leftWidthPercent - centerWidthPercent;
                    
                    if (leftWidthPercent >= 15 && leftWidthPercent <= 60 && rightWidthPercent >= 15) {
                        leftPanel.style.width = leftWidthPercent + '%';
                        rightPanel.style.width = rightWidthPercent + '%';
                    }
                } else if (currentResizer === 'resizer2') {
                    // ä¸­å¤®ãƒ‘ãƒãƒ«ã®ãƒªã‚µã‚¤ã‚º
                    const leftWidthPercent = parseFloat(leftPanel.style.width) || 25;
                    const rightEdgeX = containerWidth - mouseX;
                    const rightWidthPercent = (rightEdgeX / containerWidth) * 100;
                    const centerWidthPercent = 100 - leftWidthPercent - rightWidthPercent;
                    
                    if (centerWidthPercent >= 20 && rightWidthPercent >= 15 && rightWidthPercent <= 60) {
                        centerPanel.style.width = centerWidthPercent + '%';
                        rightPanel.style.width = rightWidthPercent + '%';
                    }
                }
            });
            
            document.addEventListener('mouseup', function() {
                isResizing = false;
                currentResizer = null;
                document.body.classList.remove('resizing');
            });
        }
        
        // ã‚¿ã‚°ã‚«ãƒ©ãƒ¼ãƒãƒƒãƒ”ãƒ³ã‚°
        const tagColors = {
            programming: { bg: 'bg-blue-100 dark:bg-blue-900/30', text: 'text-blue-800 dark:text-blue-200', border: 'border-blue-200 dark:border-blue-700' },
            english: { bg: 'bg-green-100 dark:bg-green-900/30', text: 'text-green-800 dark:text-green-200', border: 'border-green-200 dark:border-green-700' },
            health: { bg: 'bg-purple-100 dark:bg-purple-900/30', text: 'text-purple-800 dark:text-purple-200', border: 'border-purple-200 dark:border-purple-700' },
            custom1: { bg: 'bg-orange-100 dark:bg-orange-900/30', text: 'text-orange-800 dark:text-orange-200', border: 'border-orange-200 dark:border-orange-700' },
            custom2: { bg: 'bg-teal-100 dark:bg-teal-900/30', text: 'text-teal-800 dark:text-teal-200', border: 'border-teal-200 dark:border-teal-700' },
            custom3: { bg: 'bg-rose-100 dark:bg-rose-900/30', text: 'text-rose-800 dark:text-rose-200', border: 'border-rose-200 dark:border-rose-700' }
        };
        
        // ToDoç®¡ç†æ©Ÿèƒ½
        let currentTodoText = '';
        let selectedTagIndex = 0;
        let selectedTodoItem = null;
        let selectedGoalItem = null;
        let todoIdCounter = 0;
        
        function startTodoCreation() {
            console.log('startTodoCreation called'); // ãƒ‡ãƒãƒƒã‚°ç”¨
            const input = document.getElementById('newTodoInput');
            if (!input) {
                console.error('newTodoInput element not found');
                return;
            }
            
            const todoText = input.value.trim();
            console.log('Todo text:', todoText); // ãƒ‡ãƒãƒƒã‚°ç”¨
            
            if (todoText === '') {
                console.log('Empty todo text, returning');
                return;
            }
            
            currentTodoText = todoText;
            console.log('Calling showTagSelectionModal'); // ãƒ‡ãƒãƒƒã‚°ç”¨
            showTagSelectionModal();
        }
        
        function showTagSelectionModal() {
            console.log('showTagSelectionModal called'); // ãƒ‡ãƒãƒƒã‚°ç”¨
            const modal = document.getElementById('tagSelectionModal');
            const preview = document.getElementById('taskPreview');
            
            if (!modal) {
                console.error('tagSelectionModal not found');
                return;
            }
            
            if (!preview) {
                console.error('taskPreview not found');
                return;
            }
            
            console.log('Setting preview text and showing modal'); // ãƒ‡ãƒãƒƒã‚°ç”¨
            preview.textContent = `ã‚¿ã‚¹ã‚¯: "${currentTodoText}"`;
            modal.classList.remove('hidden');
            
            // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–
            selectedTagIndex = 0;
            updateTagSelection();
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’è¨­å®šã—ã€ã‚­ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£
            setTimeout(() => {
                modal.focus();
            }, 10);
            
            // èƒŒæ™¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’é˜²æ­¢
            document.body.style.overflow = 'hidden';
            console.log('Modal should be visible now'); // ãƒ‡ãƒãƒƒã‚°ç”¨
        }
        
        function hideTagSelectionModal() {
            const modal = document.getElementById('tagSelectionModal');
            modal.classList.add('hidden');
            currentTodoText = '';
            selectedTagIndex = 0;
            
            // èƒŒæ™¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’å¾©å…ƒ
            document.body.style.overflow = '';
            
            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’æˆ»ã™
            setTimeout(() => {
                document.getElementById('newTodoInput').focus();
            }, 10);
        }
        
        function updateTagSelection() {
            const options = document.querySelectorAll('.tag-option');
            options.forEach((option, index) => {
                if (index === selectedTagIndex) {
                    option.classList.add('ring-2', 'ring-blue-400', 'border-blue-400');
                    option.classList.remove('border-transparent');
                    // é¸æŠã•ã‚ŒãŸè¦ç´ ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                    option.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                } else {
                    option.classList.remove('ring-2', 'ring-blue-400', 'border-blue-400');
                    option.classList.add('border-transparent');
                }
            });
        }
        
        function selectTag(categoryValue) {
            if (categoryValue) {
                const colors = tagColors[categoryValue];
                const categoryText = getTagText(categoryValue);
                createTodoWithTag(currentTodoText, categoryValue, categoryText, colors);
            } else {
                // ã‚¿ã‚°ãªã—ã§è¿½åŠ 
                createTodoWithoutTag(currentTodoText);
            }
            
            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªã‚¢
            document.getElementById('newTodoInput').value = '';
            hideTagSelectionModal();
        }
        
        function createTodoWithTag(todoText, categoryValue, categoryText, colors) {
            todoIdCounter++;
            const todoItem = document.createElement('div');
            todoItem.id = `todo-item-${todoIdCounter}`;
            todoItem.className = 'todo-item flex items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer transition-colors hover:bg-gray-100 dark:hover:bg-gray-600';
            todoItem.setAttribute('data-todo-id', todoIdCounter);
            todoItem.innerHTML = `
                <input type="checkbox" class="mr-3 w-4 h-4 text-blue-600 rounded">
                <span class="flex-1">${todoText}</span>
                <span class="text-xs px-2 py-1 rounded ${colors.bg} ${colors.text} ${colors.border} border">${categoryText}</span>
            `;
            
            // ã‚¯ãƒªãƒƒã‚¯é¸æŠæ©Ÿèƒ½ã‚’è¿½åŠ 
            todoItem.addEventListener('click', function(e) {
                console.log('ToDo item clicked:', todoItem);
                if (e.target.type !== 'checkbox') { // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ä»¥å¤–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆ
                    selectTodoItem(todoItem);
                }
            });
            
            const todoList = document.querySelector('.space-y-2');
            todoList.appendChild(todoItem);
        }
        
        function createTodoWithoutTag(todoText) {
            todoIdCounter++;
            const todoItem = document.createElement('div');
            todoItem.id = `todo-item-${todoIdCounter}`;
            todoItem.className = 'todo-item flex items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer transition-colors hover:bg-gray-100 dark:hover:bg-gray-600';
            todoItem.setAttribute('data-todo-id', todoIdCounter);
            todoItem.innerHTML = `
                <input type="checkbox" class="mr-3 w-4 h-4 text-blue-600 rounded">
                <span class="flex-1">${todoText}</span>
            `;
            
            // ã‚¯ãƒªãƒƒã‚¯é¸æŠæ©Ÿèƒ½ã‚’è¿½åŠ 
            todoItem.addEventListener('click', function(e) {
                console.log('ToDo item clicked:', todoItem);
                if (e.target.type !== 'checkbox') { // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ä»¥å¤–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆ
                    selectTodoItem(todoItem);
                }
            });
            
            const todoList = document.querySelector('.space-y-2');
            todoList.appendChild(todoItem);
        }
        
        function getTagText(categoryValue) {
            const tagLabels = {
                programming: 'ğŸ“š ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚¹ã‚­ãƒ«å‘ä¸Š',
                english: 'ğŸ—£ï¸ è‹±èªå­¦ç¿’',
                health: 'ğŸƒ å¥åº·ç®¡ç†',
                custom1: document.getElementById('custom1Label').textContent,
                custom2: document.getElementById('custom2Label').textContent,
                custom3: document.getElementById('custom3Label').textContent
            };
            return tagLabels[categoryValue] || categoryValue;
        }
        
        function handleTagModalKeydown(e) {
            const options = document.querySelectorAll('.tag-option');
            
            switch(e.key) {
                case 'ArrowDown':
                    e.preventDefault();
                    selectedTagIndex = Math.min(selectedTagIndex + 1, options.length - 1);
                    updateTagSelection();
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    selectedTagIndex = Math.max(selectedTagIndex - 1, 0);
                    updateTagSelection();
                    break;
                case 'Enter':
                    e.preventDefault();
                    const selectedOption = options[selectedTagIndex];
                    if (selectedOption) {
                        const categoryValue = selectedOption.getAttribute('data-value');
                        selectTag(categoryValue);
                    }
                    break;
                case 'Escape':
                    e.preventDefault();
                    hideTagSelectionModal();
                    break;
            }
        }
        
        // ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚°ç·¨é›†æ©Ÿèƒ½
        let editingFromTagSelection = false;
        
        function startEditTag(tagId) {
            editingFromTagSelection = true;
            showTagEditModal();
            
            // ç¾åœ¨ã®å€¤ã‚’ãƒ¢ãƒ¼ãƒ€ãƒ«ã«è¨­å®š
            const currentValues = {
                custom1: document.getElementById('custom1Label').textContent,
                custom2: document.getElementById('custom2Label').textContent,
                custom3: document.getElementById('custom3Label').textContent
            };
            
            document.getElementById('editCustom1Input').value = currentValues.custom1;
            document.getElementById('editCustom2Input').value = currentValues.custom2;
            document.getElementById('editCustom3Input').value = currentValues.custom3;
            
            // ç·¨é›†å¯¾è±¡ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
            setTimeout(() => {
                document.getElementById(`edit${tagId.charAt(0).toUpperCase() + tagId.slice(1)}Input`).focus();
            }, 100);
        }
        
        function showTagEditModal() {
            const modal = document.getElementById('tagEditModal');
            modal.classList.remove('hidden');
            
            setTimeout(() => {
                modal.focus();
            }, 10);
        }
        
        function hideTagEditModal() {
            const modal = document.getElementById('tagEditModal');
            modal.classList.add('hidden');
            
            if (editingFromTagSelection) {
                // ã‚¿ã‚°é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«ã«æˆ»ã‚‹
                setTimeout(() => {
                    document.getElementById('tagSelectionModal').focus();
                }, 10);
                editingFromTagSelection = false;
            }
        }
        
        function saveCustomTagEdits() {
            const newValues = {
                custom1: document.getElementById('editCustom1Input').value.trim(),
                custom2: document.getElementById('editCustom2Input').value.trim(),
                custom3: document.getElementById('editCustom3Input').value.trim()
            };
            
            // ãƒ©ãƒ™ãƒ«ã‚’æ›´æ–°ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã¨å¤–éƒ¨ç·¨é›†ã‚¨ãƒªã‚¢ã®ä¸¡æ–¹ï¼‰
            Object.keys(newValues).forEach(tagId => {
                const value = newValues[tagId];
                if (value) {
                    // ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®ãƒ©ãƒ™ãƒ«æ›´æ–°
                    document.getElementById(`${tagId}Label`).textContent = value;
                    
                    // å¤–éƒ¨ç·¨é›†ã‚¨ãƒªã‚¢ã®å€¤ã‚‚æ›´æ–°
                    const externalInput = document.getElementById(`${tagId}Input`);
                    if (externalInput) {
                        externalInput.value = value.replace(/^[\u{1F300}-\u{1F9FF}]\s*/u, ''); // çµµæ–‡å­—ã‚’é™¤å»ã—ã¦è¨­å®š
                    }
                }
            });
            
            hideTagEditModal();
        }
        
        function updateCustomTag(tagId, newValue) {
            const label = document.getElementById(`${tagId}Label`);
            
            if (newValue.trim() === '') {
                return;
            }
            
            // çµµæ–‡å­—ãŒå«ã¾ã‚Œã¦ã„ãªã„å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’è¿½åŠ 
            let newText = newValue.trim();
            if (!/^[\u{1F300}-\u{1F9FF}]/u.test(newText)) {
                const defaultEmojis = { custom1: 'ğŸ“š', custom2: 'ğŸ ', custom3: 'ğŸ¨' };
                newText = `${defaultEmojis[tagId]} ${newText}`;
            }
            
            label.textContent = newText;
        }
        
        // ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—æ©Ÿèƒ½
        
        function generateSampleData() {
            const data = {};
            const today = new Date();
            
            // éå»365æ—¥ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
            for (let i = 0; i < 365; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                // ãƒ©ãƒ³ãƒ€ãƒ ãªå­¦ç¿’æ™‚é–“ï¼ˆ0-8æ™‚é–“ã€é€±æœ«ã¯å°‘ãªã‚ï¼‰
                const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                const maxHours = isWeekend ? 4 : 8;
                const hours = Math.random() < 0.15 ? 0 : Math.floor(Math.random() * maxHours) + 1;
                
                data[dateStr] = hours;
            }
            
            return data;
        }
        
        function getIntensityClass(hours) {
            if (hours === 0) return 'bg-gray-100 dark:bg-gray-600';
            if (hours <= 1) return 'bg-green-100 dark:bg-green-900/30';
            if (hours <= 2) return 'bg-green-200 dark:bg-green-800/50';
            if (hours <= 3) return 'bg-green-300 dark:bg-green-700/70';
            if (hours <= 4) return 'bg-green-400 dark:bg-green-600';
            if (hours <= 5) return 'bg-green-500 dark:bg-green-500';
            return 'bg-green-600 dark:bg-green-400';
        }
        
        function formatDate(date) {
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
            const dayName = dayNames[date.getDay()];
            
            return `${year}å¹´${month}æœˆ${day}æ—¥ (${dayName})`;
        }
        
        
        function generateDailyHeatmap() {
            const heatmapData = generateSampleData();
            const grid = document.getElementById('dailyHeatmapGrid');
            const monthContainer = document.getElementById('monthLabelsContainer');
            grid.innerHTML = '';
            monthContainer.innerHTML = '';
            
            const today = new Date();
            const oneYearAgo = new Date(today);
            oneYearAgo.setFullYear(today.getFullYear() - 1);
            
            // é–‹å§‹æ—¥ã‚’æ—¥æ›œæ—¥ã«èª¿æ•´ï¼ˆGitHubã‚¹ã‚¿ã‚¤ãƒ«ï¼‰
            const startDate = new Date(oneYearAgo);
            startDate.setDate(startDate.getDate() - startDate.getDay());
            
            // é€±æ•°ã‚’è¨ˆç®—
            const totalDays = Math.ceil((today - startDate) / (1000 * 60 * 60 * 24));
            const totalWeeks = Math.ceil(totalDays / 7);
            
            // æœˆãƒ©ãƒ™ãƒ«ã‚’ç”Ÿæˆ
            generateMonthLabels(startDate, totalWeeks, monthContainer);
            
            // ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã‚°ãƒªãƒƒãƒ‰ã‚’ç”Ÿæˆï¼ˆç¸¦7è¡Œ Ã— æ¨ªé€±æ•°åˆ—ï¼‰
            grid.className = 'flex gap-0.5';
            
            for (let week = 0; week < totalWeeks; week++) {
                const weekColumn = document.createElement('div');
                weekColumn.className = 'flex flex-col gap-0.5';
                
                for (let day = 0; day < 7; day++) {
                    const date = new Date(startDate);
                    date.setDate(date.getDate() + (week * 7 + day));
                    
                    // æœªæ¥ã®æ—¥ä»˜ã‚„1å¹´ä»¥ä¸Šå‰ã¯ã‚¹ã‚­ãƒƒãƒ—
                    if (date > today || date < oneYearAgo) {
                        const emptyCell = document.createElement('div');
                        emptyCell.className = 'w-3 h-3';
                        weekColumn.appendChild(emptyCell);
                        continue;
                    }
                    
                    const dateStr = date.toISOString().split('T')[0];
                    const hours = heatmapData[dateStr] || 0;
                    
                    const dayCell = document.createElement('div');
                    dayCell.className = `w-3 h-3 ${getIntensityClass(hours)} rounded-sm cursor-pointer transition-all duration-200 hover:scale-125 border border-gray-200 dark:border-gray-600`;
                    
                    // ä»Šæ—¥ã®åˆ†ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                    if (dateStr === today.toISOString().split('T')[0]) {
                        dayCell.classList.add('animate-pulse');
                    }
                    
                    // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿
                    dayCell.setAttribute('data-date', dateStr);
                    dayCell.setAttribute('data-hours', hours);
                    dayCell.setAttribute('data-formatted-date', formatDate(date));
                    
                    weekColumn.appendChild(dayCell);
                }
                
                grid.appendChild(weekColumn);
            }
            
            // ä»Šæ—¥ã®æ—¥ä»˜ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«åˆæœŸã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’è¨­å®šï¼ˆä¸€ç•ªå³ï¼‰
            setTimeout(() => {
                const scrollContainer = document.getElementById('heatmapScrollContainer');
                const monthScrollContainer = document.getElementById('monthLabelsScrollContainer');
                
                if (scrollContainer && monthScrollContainer) {
                    // ä¸€ç•ªå³ç«¯ï¼ˆä»Šæ—¥ã®æ—¥ä»˜ï¼‰ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                    const maxScroll = scrollContainer.scrollWidth - scrollContainer.clientWidth;
                    
                    scrollContainer.scrollLeft = maxScroll;
                    monthScrollContainer.scrollLeft = maxScroll;
                    
                    // æœˆãƒ©ãƒ™ãƒ«ã¨ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åŒæœŸ
                    scrollContainer.addEventListener('scroll', function() {
                        monthScrollContainer.scrollLeft = scrollContainer.scrollLeft;
                    });
                    
                    monthScrollContainer.addEventListener('scroll', function() {
                        scrollContainer.scrollLeft = monthScrollContainer.scrollLeft;
                    });
                }
            }, 100);
        }
        
        function generateMonthLabels(startDate, totalWeeks, container) {
            const monthPositions = [];
            let currentMonth = -1;
            
            // å„é€±ã®æœ€åˆã®æ—¥ã®æœˆã‚’ç¢ºèªï¼ˆæœ€ä½3é€±é–“ã®ã‚¹ãƒšãƒ¼ã‚¹ãŒå¿…è¦ï¼‰
            for (let week = 0; week < totalWeeks; week++) {
                const weekStart = new Date(startDate);
                weekStart.setDate(weekStart.getDate() + week * 7);
                
                if (weekStart.getMonth() !== currentMonth) {
                    currentMonth = weekStart.getMonth();
                    
                    // å‰ã®æœˆã‹ã‚‰ååˆ†ãªè·é›¢ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                    const lastPos = monthPositions[monthPositions.length - 1];
                    if (!lastPos || week - lastPos.week >= 3) {
                        monthPositions.push({
                            week: week,
                            month: currentMonth,
                            name: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 
                                   'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'][currentMonth]
                        });
                    }
                }
            }
            
            // æœˆãƒ©ãƒ™ãƒ«ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆ
            container.className = 'relative flex';
            // ã‚»ãƒ«å¹…12pxï¼ˆw-3ï¼‰+ gap-0.5ï¼ˆ2pxï¼‰= 14px per week
            const cellWidth = 14;
            container.style.width = `${totalWeeks * cellWidth}px`;
            container.style.height = '14px'; // ãƒ©ãƒ™ãƒ«ç”¨ã®ååˆ†ãªé«˜ã•
            
            monthPositions.forEach(pos => {
                const monthLabel = document.createElement('div');
                monthLabel.className = 'absolute text-xs text-gray-500 dark:text-gray-400';
                monthLabel.style.left = `${pos.week * cellWidth}px`;
                monthLabel.style.top = '0px';
                monthLabel.textContent = pos.name;
                container.appendChild(monthLabel);
            });
        }
        
        function initHeatmapTooltip() {
            const tooltip = document.getElementById('heatmapTooltip');
            const tooltipContent = document.getElementById('tooltipContent');
            
            // ã‚¤ãƒ™ãƒ³ãƒˆå§”ä»»ã§ãƒ›ãƒãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‡¦ç†
            document.addEventListener('mouseover', function(e) {
                if (e.target.hasAttribute('data-date')) {
                    const date = e.target.getAttribute('data-formatted-date');
                    const hours = e.target.getAttribute('data-hours');
                    
                    tooltipContent.textContent = `${date}: ${hours}æ™‚é–“`;
                    
                    // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã®ä½ç½®ã‚’è¨ˆç®—
                    const rect = e.target.getBoundingClientRect();
                    const tooltipRect = tooltip.getBoundingClientRect();
                    
                    tooltip.style.left = `${rect.left + rect.width / 2 - tooltipRect.width / 2}px`;
                    tooltip.style.top = `${rect.top - tooltipRect.height - 8}px`;
                    tooltip.classList.remove('opacity-0');
                    tooltip.classList.add('opacity-100');
                }
            });
            
            document.addEventListener('mouseout', function(e) {
                if (e.target.hasAttribute('data-date')) {
                    tooltip.classList.remove('opacity-100');
                    tooltip.classList.add('opacity-0');
                }
            });
        }
        
        
        // ToDoé¸æŠã¨å‰Šé™¤æ©Ÿèƒ½
        function selectTodoItem(todoItem) {
            // æ—¢å­˜ã®é¸æŠçŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢
            if (selectedTodoItem) {
                selectedTodoItem.classList.remove('ring-2', 'ring-blue-500', 'bg-blue-50', 'dark:bg-blue-900/20');
            }
            
            // ç›®æ¨™ã®é¸æŠã‚‚ã‚¯ãƒªã‚¢
            clearGoalSelection();
            
            // æ–°ã—ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’é¸æŠ
            selectedTodoItem = todoItem;
            todoItem.classList.add('ring-2', 'ring-blue-500', 'bg-blue-50', 'dark:bg-blue-900/20');
            
            console.log('ToDo item selected:', todoItem);
        }
        
        function deleteTodoItem() {
            if (selectedTodoItem) {
                console.log('Deleting todo item:', selectedTodoItem);
                selectedTodoItem.remove();
                selectedTodoItem = null;
            } else {
                console.log('No todo item selected for deletion');
            }
        }
        
        function clearTodoSelection() {
            if (selectedTodoItem) {
                selectedTodoItem.classList.remove('ring-2', 'ring-blue-500', 'bg-blue-50', 'dark:bg-blue-900/20');
                selectedTodoItem = null;
            }
        }
        
        // ç›®æ¨™é¸æŠã¨å‰Šé™¤æ©Ÿèƒ½
        function selectGoalItem(goalItem) {
            // æ—¢å­˜ã®é¸æŠçŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢
            if (selectedGoalItem) {
                selectedGoalItem.classList.remove('ring-2', 'ring-blue-500');
            }
            
            // ToDoã®é¸æŠã‚‚ã‚¯ãƒªã‚¢
            clearTodoSelection();
            
            // æ–°ã—ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’é¸æŠ
            selectedGoalItem = goalItem;
            goalItem.classList.add('ring-2', 'ring-blue-500');
            
            console.log('Goal item selected:', goalItem);
        }
        
        function deleteGoalItem() {
            if (selectedGoalItem) {
                console.log('Deleting goal item:', selectedGoalItem);
                selectedGoalItem.remove();
                selectedGoalItem = null;
            } else {
                console.log('No goal item selected for deletion');
            }
        }
        
        function clearGoalSelection() {
            if (selectedGoalItem) {
                selectedGoalItem.classList.remove('ring-2', 'ring-blue-500');
                selectedGoalItem = null;
            }
        }
        
        // åˆæœŸåŒ–
        // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
        function toggleDarkMode() {
            const html = document.documentElement;
            const isDark = html.classList.contains('dark');
            
            if (isDark) {
                html.classList.remove('dark');
                localStorage.setItem('darkMode', 'false');
            } else {
                html.classList.add('dark');
                localStorage.setItem('darkMode', 'true');
            }
        }
        
        // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã®åˆæœŸçŠ¶æ…‹ã‚’è¨­å®š
        function initDarkMode() {
            const savedMode = localStorage.getItem('darkMode');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (savedMode === 'true' || (savedMode === null && prefersDark)) {
                document.documentElement.classList.add('dark');
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã‚’åˆæœŸåŒ–
        initDarkMode();
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM fully loaded');
            
            updateButtons();
            initPanelResize();
            
            // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            const darkModeToggle = document.getElementById('darkModeToggle');
            if (darkModeToggle) {
                darkModeToggle.addEventListener('click', toggleDarkMode);
            }
            
            // ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—åˆæœŸåŒ–
            generateDailyHeatmap();
            initHeatmapTooltip();
            
            // ãƒ‡ãƒãƒƒã‚°ï¼šã™ã¹ã¦ã®å¿…è¦ãªè¦ç´ ã®å­˜åœ¨ç¢ºèª
            console.log('Checking for required elements:');
            console.log('addTodoBtn:', document.getElementById('addTodoBtn'));
            console.log('newTodoInput:', document.getElementById('newTodoInput'));
            console.log('tagSelectionModal:', document.getElementById('tagSelectionModal'));
            console.log('taskPreview:', document.getElementById('taskPreview'));
            
            // ToDoè¿½åŠ ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            const addBtn = document.getElementById('addTodoBtn');
            const todoInput = document.getElementById('newTodoInput');
            
            if (addBtn) {
                console.log('Adding click event listener to addTodoBtn');
                addBtn.addEventListener('click', function() {
                    console.log('Add button clicked'); // ãƒ‡ãƒãƒƒã‚°ç”¨
                    startTodoCreation();
                });
            } else {
                console.error('addTodoBtn not found');
            }
            
            if (todoInput) {
                console.log('Adding keypress event listener to newTodoInput');
                todoInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        console.log('Enter key pressed'); // ãƒ‡ãƒãƒƒã‚°ç”¨
                        startTodoCreation();
                    }
                });
            } else {
                console.error('newTodoInput not found');
            }
            
            // ã‚¿ã‚°é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            const tagModal = document.getElementById('tagSelectionModal');
            if (tagModal) {
                console.log('Adding keydown event listener to tagModal');
                tagModal.addEventListener('keydown', handleTagModalKeydown);
            } else {
                console.error('tagSelectionModal not found');
            }
            
            // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚­ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºä¸­ã®ã¿ï¼‰
            document.addEventListener('keydown', function(e) {
                if (tagModal && !tagModal.classList.contains('hidden') && document.getElementById('tagEditModal') && document.getElementById('tagEditModal').classList.contains('hidden')) {
                    // ã‚¿ã‚°é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºä¸­ã‹ã¤ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒéè¡¨ç¤ºã®å ´åˆ
                    if (['ArrowUp', 'ArrowDown', 'Enter', 'Escape'].includes(e.key)) {
                        e.preventDefault();
                        e.stopPropagation();
                        handleTagModalKeydown(e);
                    }
                }
            }, true);
            
            const cancelBtn = document.getElementById('cancelTagSelection');
            const skipBtn = document.getElementById('skipTagSelection');
            
            if (cancelBtn) {
                cancelBtn.addEventListener('click', hideTagSelectionModal);
            } else {
                console.error('cancelTagSelection button not found');
            }
            
            if (skipBtn) {
                skipBtn.addEventListener('click', () => selectTag(null));
            } else {
                console.error('skipTagSelection button not found');
            }
            
            // ã‚¿ã‚°ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
            document.querySelectorAll('.tag-option').forEach((option, index) => {
                option.addEventListener('click', function() {
                    const categoryValue = this.getAttribute('data-value');
                    selectTag(categoryValue);
                });
            });
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
            if (tagModal) {
                tagModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        hideTagSelectionModal();
                    }
                });
            }
            
            // ã‚¿ã‚°ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            const editModal = document.getElementById('tagEditModal');
            const cancelEditBtn = document.getElementById('cancelTagEdit');
            
            if (cancelEditBtn) {
                cancelEditBtn.addEventListener('click', hideTagEditModal);
            } else {
                console.error('cancelTagEdit button not found');
            }
            const saveEditBtn = document.getElementById('saveTagEdit');
            if (saveEditBtn) {
                saveEditBtn.addEventListener('click', saveCustomTagEdits);
            } else {
                console.error('saveTagEdit button not found');
            }
            
            // ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
            if (editModal) {
                editModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        hideTagEditModal();
                    }
                });
            }
            
            // ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã§Enterã‚­ãƒ¼ã§ä¿å­˜
            if (editModal) {
                editModal.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && e.target.tagName === 'INPUT') {
                        e.preventDefault();
                        saveCustomTagEdits();
                    } else if (e.key === 'Escape') {
                        e.preventDefault();
                        hideTagEditModal();
                    }
                });
            }
            
            // ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚°ç·¨é›†ã¯ãƒ¢ãƒ¼ãƒ€ãƒ«çµŒç”±ã§è¡Œã†ãŸã‚ã€å€‹åˆ¥ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ä¸è¦
            
            // PCãƒ­ãƒƒã‚¯æ¤œçŸ¥ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            document.addEventListener('visibilitychange', handleVisibilityChange);
            
            // ç›®æ¨™ã‚«ãƒ¼ãƒ‰ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
            document.querySelectorAll('.goal-item').forEach(goalItem => {
                goalItem.addEventListener('click', function(e) {
                    console.log('Goal item clicked:', goalItem);
                    selectGoalItem(goalItem);
                });
            });
            
            // æ—¢å­˜ã®ToDoã‚«ãƒ¼ãƒ‰ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
            document.querySelectorAll('.todo-item').forEach(todoItem => {
                todoItem.addEventListener('click', function(e) {
                    console.log('Existing ToDo item clicked:', todoItem);
                    if (e.target.type !== 'checkbox') { // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ä»¥å¤–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆ
                        selectTodoItem(todoItem);
                    }
                });
            });
            
            // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼ˆToDoãƒ»ç›®æ¨™å‰Šé™¤ï¼‰
            document.addEventListener('keydown', function(e) {
                // ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒé–‹ã„ã¦ã„ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
                if (!document.getElementById('tagSelectionModal').classList.contains('hidden') || 
                    !document.getElementById('tagEditModal').classList.contains('hidden')) {
                    return;
                }
                
                // Delete ã¾ãŸã¯ Backspace ã‚­ãƒ¼ã§é¸æŠã•ã‚ŒãŸã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤
                if (e.key === 'Delete' || e.key === 'Backspace') {
                    e.preventDefault();
                    if (selectedTodoItem) {
                        deleteTodoItem();
                    } else if (selectedGoalItem) {
                        deleteGoalItem();
                    }
                }
                
                // Escapeã‚­ãƒ¼ã§é¸æŠã‚’ã‚¯ãƒªã‚¢
                if (e.key === 'Escape') {
                    clearTodoSelection();
                    clearGoalSelection();
                }
            });
            
            // ToDoé ˜åŸŸå¤–ã‚¯ãƒªãƒƒã‚¯ã§é¸æŠã‚’ã‚¯ãƒªã‚¢
            document.addEventListener('click', function(e) {
                // ToDoé …ç›®ã¾ãŸã¯ãã®å­è¦ç´ ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
                if (e.target.closest('.todo-item') || e.target.closest('.goal-item')) {
                    return;
                }
                
                // ToDoå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚„ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
                if (e.target.closest('#newTodoInput') || e.target.closest('#addTodoBtn')) {
                    return;
                }
                
                // ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®ã‚¯ãƒªãƒƒã‚¯ã¯ã‚¹ã‚­ãƒƒãƒ—
                if (e.target.closest('#tagSelectionModal') || e.target.closest('#tagEditModal')) {
                    return;
                }
                
                // ãã®ä»–ã®å ´æ‰€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆã¯é¸æŠã‚’ã‚¯ãƒªã‚¢
                clearTodoSelection();
                clearGoalSelection();
            });
        });
        
    </script>
</body>
</html>