# Daily Focus View 仕様書

## 概要
Daily Focus Viewは、ユーザーの日々の学習・作業に特化したフォーカス支援インターフェースです。学習時間トラッキング、目標管理、ToDoリスト、アウトプット記録を統合的に提供し、効率的なタスク管理と成長記録を可能にします。

## レイアウト構成

### 画面全体
- **3パネル構成**: 左パネル（目標管理・学習時間）、中央パネル（ToDoリスト）、右パネル（アウトプット・成長記録）
- **リサイズ可能**: パネル間にリサイズハンドル配置、ドラッグで幅調整可能
- **上部ナビゲーション**: ビュー切り替えボタン（アイコンのみ表示）
- **ダークモード対応**: 
  - 右上にダークモード切り替えボタン配置
  - ライトモード時：月アイコン、ダークモード時：太陽アイコン
  - システム設定自動検出（prefers-color-scheme）
  - localStorage での設定永続化
  - 全体的なダークテーマ切り替え

## 左パネル: 目標管理・学習時間トラッキング

### 今月の目標セクション（上部）
- **月次目標一覧**
  - カテゴリ別カラーコーディング（プログラミング：青、英語：緑、健康：紫）
  - 目標タイトルと詳細説明
  - グラデーション背景とボーダー
  - **選択・削除機能**: クリック選択、Delete/Backspaceキーで削除
  - **視覚的フィードバック**: 選択時青いリング表示、ホバー効果

- **新規目標追加**
  - 「+ 新しい目標を追加」ボタン
  - ダッシュボーダーデザイン

### 学習時間トラッキングセクション（下部）
- **現在のセッション状態**
  - セッション経過時間（00:00:00形式）
  - 今日の累計時間表示
  - 白背景カード形式

- **学習制御**
  - カテゴリ選択ドロップダウン（プログラミング、英語学習、読書、運動、その他）
  - 学習開始・一時停止・終了ボタン
  - 状態に応じたボタンの有効/無効切り替え
  - **PCロック検知**: 自動一時停止機能

- **今日のカテゴリ別学習時間**
  - 各カテゴリの今日の累計時間
  - 絵文字アイコン付き表示
  - グレー背景セクション

## 中央パネル: ToDo管理

### 今日のToDoリスト
- **日付表示**: 現在の日付（YYYY年MM月DD日 (曜日)）
- **ToDoアイテム表示**
  - チェックボックス
  - タスク名
  - カテゴリタグ（カラーコーディング済み）
  - 完了済みタスクは取り消し線表示
  - **選択・削除機能**: 
    - クリック選択（青いリング + 背景色変更）
    - ホバー効果
    - Delete/Backspaceキーで削除
    - Escapeキーで選択解除
    - 領域外クリックで選択解除

### 高度なToDo追加機能
- **効率的なワークフロー**
  - タスク名入力後にタグ選択（逆順ワークフロー）
  - Enterキーでの追加対応
  - モーダルベースタグ選択

- **分類タグシステム**
  - **今月の目標とリンク**: プログラミングスキル向上（青）、英語学習（緑）、健康管理（紫）
  - **カスタムタグ（3つ）**: 読書（オレンジ）、家事（ティール）、趣味（ローズ）
  - **カラー自動同期**: 目標カラーとタグカラーの自動連携
  - グラデーション背景でカラー識別

- **タグ選択モーダル**
  - **キーボードナビゲーション**: 矢印キー + Enterでマウスレス操作
  - **フォーカス管理**: 適切なイベントキャプチャ
  - **コンパクトデザイン**: 全タグが一目で見える設計
  - **タグ編集統合**: モーダル内でのカスタムタグ編集
  - 「タグなしで追加」「キャンセル」オプション

- **カスタムタグ編集**
  - モーダル経由での編集機能
  - 自動絵文字追加機能
  - リアルタイム更新
  - カラーインジケーター表示

## 右パネル: アウトプットメモ・成長可視化

### 学習メモセクション
- **メモエディタ**
  - Markdownサポート
  - プレースホルダーテンプレート（React Hooks例）
  - リサイズ可能なテキストエリア
  - 最小高さ300px

### 成長可視化ダッシュボード
- **GitHubスタイル活動ヒートマップ**
  - **期間**: 過去365日のアクティビティ表示
  - **視覚化**: 学習時間に応じた緑色濃淡（0時間=グレー、1-6時間=緑の段階的濃淡）
  - **詳細情報**: ホバー時ツールチップ（日付 + 学習時間）
  - **現在活動**: 今日の分にアニメーション効果（animate-pulse）
  - **レイアウト**: 
    - **軸ラベル**: 横軸（月：Jan-Dec）、縦軸（曜日：Sun-Sat、日曜日始まり）
    - **英語表記**: 国際標準に準拠した月・曜日表示
    - **凡例表示**: Less ← → More（活動レベル表示）
  - **スクロール機能**:
    - 横スクロール対応（過去365日分）
    - 初期位置：最新の日付（今日）が見える位置（右端）
    - 月ラベルとヒートマップの同期スクロール
  - **視認性向上**:
    - セル間隔調整（gap-0.5で適度な間隔）
    - セル境界線表示（border border-gray-200 dark:border-gray-600）
    - ホバー時拡大エフェクト（hover:scale-125）
  - **ダークモード対応**: テーマに応じた色調整・境界線対応

## 削除された機能（要件に基づく削除）

以下の機能は過剰実装として削除されました：
- ~~時間帯別フォーカスフローインジケーター~~
- ~~時間帯別テーマカラー自動切り替え~~
- ~~AI提案機能~~
- ~~メモからの自動クイズ生成~~
- ~~内容の自動要約・構造化~~
- ~~画像ドラッグ&ドロップ機能~~
- ~~Chart.js週間学習時間グラフ~~
- ~~アウトプット連続日数カード~~
- ~~統計情報カード（今月学習時間、連続日数、最長記録、目標達成率）~~

## 技術仕様

### フロントエンド
- **フレームワーク**: HTML5 + Vanilla JavaScript
- **スタイリング**: Tailwind CSS 3.x（CDN版）
- **ダークモード**: CSS Custom Properties + Tailwind Dark Mode
- **正規表現**: Unicode対応絵文字処理（\u{1F300}-\u{1F9FF}）

### 主要JavaScript機能
- **学習時間管理**: セッション制御、一時停止/再開、カテゴリ別集計
- **PCロック検知**: Visibility API使用、自動一時停止
- **ToDo管理**: 
  - 動的追加・削除
  - カテゴリタグシステム
  - 選択・削除インタラクション
  - モーダルベースタグ選択
- **目標管理**: 選択・削除機能
- **パネルリサイズ**: マウスドラッグによる幅調整
- **リアルタイム更新**: 1秒間隔のタイマー更新
- **ダークモード制御**: 
  - toggleDarkMode() 関数
  - initDarkMode() 初期化
  - localStorage 永続化
  - システム設定検出
- **ヒートマップ機能**:
  - 365日分データ生成・表示
  - 横スクロール制御
  - 月ラベル・ヒートマップ同期スクロール
  - 初期位置自動調整（最新日付表示）

### 選択・削除システム
- **統合的削除**: ToDoと目標の統一的削除システム
- **相互排他選択**: ToDoまたは目標の単一選択
- **キーボードショートカット**: Delete/Backspace（削除）、Escape（選択解除）
- **視覚的フィードバック**: 選択時の青いリング、ホバー効果
- **フォーカス管理**: モーダル表示中の操作無効化
- **デバッグ機能**: 包括的なコンソールログ

### パネルリサイズ機能
- **リサイズハンドル**: パネル間に配置、ホバー時青色ハイライト
- **制約条件**: 左・右パネル15%以上、中央パネル20%以上
- **ドラッグ操作**: mousedown/mousemove/mouseupイベント
- **視覚フィードバック**: resizingクラスでuser-select無効化

### データ構造
```javascript
// 学習セッション
learningSession = {
  startTime: Date,
  pausedTime: Number,
  isActive: Boolean,
  isPaused: Boolean,
  currentCategory: String,
  timer: Number
}

// 選択状態管理
selectedTodoItem = HTMLElement | null;
selectedGoalItem = HTMLElement | null;
todoIdCounter = Number; // ユニークID生成用

// タグカラーマッピング（ダークモード対応）
tagColors = {
  programming: { bg: 'bg-blue-100 dark:bg-blue-900/30', text: 'text-blue-800 dark:text-blue-200', border: 'border-blue-200 dark:border-blue-700' },
  english: { bg: 'bg-green-100 dark:bg-green-900/30', text: 'text-green-800 dark:text-green-200', border: 'border-green-200 dark:border-green-700' },
  health: { bg: 'bg-purple-100 dark:bg-purple-900/30', text: 'text-purple-800 dark:text-purple-200', border: 'border-purple-200 dark:border-purple-700' },
  custom1: { bg: 'bg-orange-100 dark:bg-orange-900/30', text: 'text-orange-800 dark:text-orange-200', border: 'border-orange-200 dark:border-orange-700' },
  custom2: { bg: 'bg-teal-100 dark:bg-teal-900/30', text: 'text-teal-800 dark:text-teal-200', border: 'border-teal-200 dark:border-teal-700' },
  custom3: { bg: 'bg-rose-100 dark:bg-rose-900/30', text: 'text-rose-800 dark:text-rose-200', border: 'border-rose-200 dark:border-rose-700' }
}

// ToDoアイテム（動的生成）
todoItem = {
  id: String, // ユニークID
  text: String,
  category: String,
  completed: Boolean,
  timestamp: Date,
  classList: ['todo-item', 'cursor-pointer', 'transition-colors', ...]
}

// 目標アイテム
goalItem = {
  id: String, // data-goal-id
  title: String,
  description: String,
  category: String,
  classList: ['goal-item', 'cursor-pointer', 'transition-colors', ...]
}
```

## UX/UIデザイン原則

### カラーシステム
- **目標固有色**: 
  - プログラミング: 青系（#3b82f6）
  - 英語学習: 緑系（#22c55e）
  - 健康管理: 紫系（#a855f7）
- **カスタムタグ色**:
  - 読書: オレンジ系（#f97316）
  - 家事: ティール系（#14b8a6）
  - 趣味: ローズ系（#f43f5e）
- **ヒートマップ色**:
  - 0時間: グレー（#f3f4f6）
  - 1-6時間: 緑の段階的濃淡（#dcfce7 → #16a34a）

### タイポグラフィ
- **見出し**: font-semibold, text-lg/text-md
- **本文**: font-medium, text-sm
- **補助テキスト**: text-gray-600, text-xs
- **タグテキスト**: text-xs

### インタラクション設計
- **選択フィードバック**: 
  - ToDo: 青いリング + 背景色変更
  - 目標: 青いリング
- **ホバー効果**: 背景色変更、ボーダーハイライト
- **フォーカス状態**: アウトライン表示
- **アニメーション**: 
  - ヒートマップ今日分のpulse
  - トランジション効果
- **完了状態**: チェックマーク、取り消し線
- **リサイズ**: カーソル変更（col-resize）
- **キーボードナビゲーション**: 矢印キー + Enter + Escape

### アクセシビリティ
- **キーボード操作**: 全機能のマウスレス操作対応
- **フォーカス管理**: 適切なタブ順序、モーダルフォーカストラップ
- **視覚的フィードバック**: 高コントラスト、明確な選択状態
- **ツールチップ**: ヒートマップのホバー情報
- **ダークモード**: 目に優しい夜間表示

## 実装優先順位

### 実装済み機能
1. ✅ 3パネルレイアウト構築
2. ✅ パネルリサイズ機能
3. ✅ 学習時間トラッキング（PCロック検知付き）
4. ✅ 高度なToDo管理
   - カテゴリタグ付き
   - 選択・削除機能
   - モーダルベースタグ選択
   - キーボードナビゲーション
5. ✅ 目標表示・選択・削除
6. ✅ GitHubスタイルヒートマップ（365日対応）
   - 横スクロール機能
   - 同期スクロール（月ラベル・ヒートマップ）
   - 初期位置自動調整（最新日付表示）
   - 英語表記対応（Jan-Dec、Sun-Sat）
   - 視認性向上（セル間隔・境界線）
7. ✅ カスタムタグ編集（モーダル統合）
8. ✅ 統合的カラーコーディングシステム
9. ✅ 完全ダークモード対応
   - 切り替えボタン（右上配置）
   - システム設定自動検出
   - localStorage 永続化
   - 全UIコンポーネント対応
10. ✅ 包括的デバッグシステム

### 今後の拡張候補
1. データ永続化（localStorage）
2. 学習記録の詳細分析
3. 目標進捗の自動計算
4. エクスポート機能（CSV/JSON）
5. より詳細なヒートマップ（月次/年次ビュー）
6. 学習統計の高度な分析

## セキュリティ・プライバシー
- ローカルストレージのみ使用
- 外部API連携なし
- 個人データの外部送信なし
- クライアントサイドのみで完結
- セキュアな正規表現使用

## パフォーマンス最適化
- 学習時間の効率的な更新（1秒間隔）
- イベントリスナーの適切な管理
- CSSアニメーションの最適化
- メモリリークの防止（タイマー管理）
- リサイズ処理の最適化（mousemoveイベント制御）
- DOM要素の効率的な選択・操作

## エラーハンドリング
- 包括的なnullチェック
- DOM要素存在確認
- 詳細なデバッグログ
- フォールバック処理
- 正規表現エラー対策

## ブラウザ互換性
- モダンブラウザ対応（Chrome 90+, Firefox 88+, Safari 14+）
- ES6+ JavaScript機能使用
- CSS Grid/Flexbox使用
- Tailwind CSS v3互換